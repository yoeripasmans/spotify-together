<!DOCTYPE html>
<html lang="en">

<head>
	<% include ./partials/head %>
</head>

<body>
	<% include ./partials/header %>

		<main>
			<header class="playlist-header">
				<a href="/playlists" class="button">Leave playlist</a>
				<h1 class="playlist-header__title"><%= playlistData.name %></h1>
				<p class="playlist-header__description">
					<%= playlistData.description %>
				</p>
				<span>Created by: <%= playlistData.createdBy.username %></span>
			</header>

			<section>
				<h3 class="playlist-currentusers-amount"></h3>
				<ul class="playlist-currentusers">
					<!-- <% for(var i=0; i < playlistData.activeUsers.length; i++) { %>
			<h3 class="playlist-currentusers-amount"><%= playlistData.activeUsers.length %> Users</h3>
					<li>
						<img src="<%= playlistData.activeUsers[i].profilePic %>" alt="">
						<p>
							<%= playlistData.activeUsers[i].name %>
						</p>
					</li>
					<% } %> -->
				</ul>
			</section>

			<section>
				<header class="tracklist-header">
					<h3>Songs</h3>
					<a href="#add-track" class="button show-add-tracks">Add song</a>
				</header>
				<div class="tracklist__track--top">
					<span></span>
					<span>Title</span>
					<span>Artist</span>
					<!-- <span>Album</span> -->
					<span>Added by</span>
					<span>Likes</span>

				</div>

				<ul class="tracklist queue">

					<% for(var i=0; i < playlistData.tracks.length; i++) { %>
						<li class="tracklist__track" data-id="<%= playlistData.tracks[i]._id %>" data-created="<%= playlistData.tracks[i].createdAt %>" data-name="<%= playlistData.tracks[i].name %>" data-isplaying="<%= playlistData.tracks[i].isPlaying %>">
							<img class="tracklist__track-img" src="<%= playlistData.tracks[i].album.images[1].url %>" alt="Album cover of <%= playlistData.tracks[i].name %>">
							<span class="tracklist__track-name"><%= playlistData.tracks[i].name %></span>
							<span class="tracklist__track-artist"><%= playlistData.tracks[i].artists.map(a => a.name).join(', ') %></span>
							<!-- <span class="tracklist__track-album"><%= playlistData.tracks[i].album.name %></span> -->
							<span class="tracklist__track-addedby"><%= playlistData.tracks[i].addedBy.spotifyId %></span>
							<span class="tracklist__track-likes">
								<span class="like-amount"><%= playlistData.tracks[i].likes %></span>
								<% if(playlistData.tracks[i].addedBy.spotifyId === user.spotifyId){ %>
									<button type="button" class="track-delete-button"><span>Remove</span><img class="icon" src="/icons/icon_cross.svg" alt="Cross icon"></button>
									<% } else {%>
							<%
								var liked;
								if(playlistData.tracks[i].userLiked.length === 0){ %>
								<button type="button" class="track-like-button" data-id="<%= playlistData.tracks[i]._id %>"><span>Like</span><img class="icon" src="/icons/icon_heart.svg" alt="Heart icon"></button>
								<% }
								else {
									 for(var j=0; j < playlistData.tracks[i].userLiked.length; j++) {
										if(user.spotifyId ===  playlistData.tracks[i].userLiked[j]){
											liked = true;
											break;
										 }
										else {
											liked = false;
										 }
									 }
									 if(liked === true){ %>
									<button type="button" class="track-like-button track-like-button--disabled" disabled>Like</button>
									<% } else {%>
										<button type="button" class="track-like-button"><span>Like</span><img class="icon" src="/icons/icon_heart.svg" alt="Heart icon"></button>
										<% }
								} %>
											</span>

						</li>
						<% } %>
						<% } %>
				</ul>
			</section>

			<!-- <img src="https://api.qrserver.com/v1/create-qr-code/?color=ffffff&bgcolor=000000&data=https://spotifytogether.herokuapp.com/playlist/<%= playlistData.qrCodeId%>/<%=playlistData._id %>" alt=""> -->
		</main>

		<section id="add-track">
			<div class="add-track-wrapper">
				<header>
					<h2>Add songs to <%= playlistData.name %></h2>
					<a href="#" class="close-add-tracks button">Close</a>
				</header>
				<input class="track-search" type="search" name="search" placeholder="Search for a song">

				<section class="search-results">
					<h3>Search results</h3>
					<div class="tracklist__track--top">
						<span></span>
						<span>Title</span>
						<span>Artist</span>
					</div>
					<ul class="tracklist fav-tracks search-results-list">
					</ul>
				</section>

				<section class="user-playlists-wrapper">
					<h3>Your playlists</h3>
					<ul class="user-playlists">
						<% for(var i=0; i < 4; i++) { %>
							<li class="user-playlists__item">
								<img class="tracklist__track-img" src="<%= userPlaylists[i].images[0].url %>" alt="Album cover of <%= userPlaylists[i].name %>">
								<span class="tracklist__track-name"><%= userPlaylists[i].name %></span>
							</li>
							<% } %>
					</ul>
				</section>



				<section class="top-songs">
					<div class="tracklist__track--top">
						<span></span>
						<span>Title</span>
						<span>Artist</span>
						<!-- <span>Album</span> -->


					</div>
					<ul class="tracklist fav-tracks">
						<% for(var i=0; i < topTracks.length; i++) { %>
							<li class="tracklist__track">
								<img class="tracklist__track-img" src="<%= topTracks[i].album.images[1].url %>" alt="Album cover of <%= topTracks[i].name %>">
								<span class="tracklist__track-name"><%= topTracks[i].name %></span>
								<span class="tracklist__track-artist"><%= topTracks[i].artists.map(a => a.name).join(', ') %></span>
								<button type="button" class="track-add-button"><span>Add track</span><img class="icon" src="/icons/icon_plus.svg" alt="Add icon"></button>
							</li>

							<% } %>
					</ul>
				</section>
			</div>
		</section>


		<ul class="fetch-devices-wrapper"></ul>
		<section id="player">

			<div class="player-details">
				<% if(playlistData.tracks.length > 0 ){ %>
					<img src="<%= playlistData.tracks[0].album.images[1].url %>" alt="" class="player-details__track-img">
					<div class="player-details__text">
						<p class="player-details__track-name">
							<%= playlistData.tracks[0].name %>
						</p>
						<p class="player-details__artist-name">
							<%= playlistData.tracks[0].artists.map(a => a.name).join(', ') %>
						</p>
						<div class="player-details__addedby">
							<span><%= playlistData.tracks[0].addedBy.spotifyId%></span>
						</div>
					</div>
					<% } %>
			</div>

			<% if(user.spotifyId === playlistData.admins[0]){ %>
			<div class="player-controls">
				<button class="prev-button"><span>Back</span><img class="icon" src="/icons/icon_prev.svg" alt="Prev icon"></button>
				<% if(playlistData.isPlaying == true){ %>
				<button class="play-button hidden"><span>Play</span><img class="icon" src="/icons/icon_play.svg" alt="Play icon"></button>
				<button class="pause-button">Pause</button>
				<% } else {%>
				<button class="play-button"><span>Play</span><img class="icon" src="/icons/icon_play.svg" alt="Play icon"></button>
				<button class="pause-button hidden">Pause</button>
				<% } %>
				<button class="next-button"><span>Next</span><img class="icon" src="/icons/icon_next.svg" alt="Next icon"></button>
			</div>
			<% } %>


			<button type="button" class="fetch-devices-button">Fetch Devices</button>
		</section>
		<script type="text/javascript">
			var topTracks = <%- JSON.stringify(topTracks) %>; //Make toptracks avaialbe inside client javascript
		</script>
		<% include ./partials/scripts %>
</body>

</html>
