<!DOCTYPE html>
<html lang="en">

<head>
	<% include ./partials/head %>
</head>

<body>
	<% include ./partials/header %>

		<main>
			<header class="playlist-header">
				<a href="/playlists">Leave playlist</a>
				<h1 class="playlist-header__title"><%= playlistData.name %></h1>
				<p class="playlist-header__description">
					<%= playlistData.description %>
				</p>
				<span>Created by: <%= playlistData.createdBy %></span>
			</header>

			<section>
				<h3 class="playlist-currentusers-amount"></h3>
				<ul class="playlist-currentusers">
					<!-- <% for(var i=0; i < playlistData.activeUsers.length; i++) { %>
			<h3 class="playlist-currentusers-amount"><%= playlistData.activeUsers.length %> Users</h3>
					<li>
						<img src="<%= playlistData.activeUsers[i].profilePic %>" alt="">
						<p>
							<%= playlistData.activeUsers[i].name %>
						</p>
					</li>
					<% } %> -->
				</ul>
			</section>

			<section>
				<header class="queue-header">
					<h3>Songs</h3>
					<a href="#add-track" class="button show-add-tracks">Add song</a>
				</header>

				<ul class="queue">
					<li class="queue__track--top">
						<span></span>
						<span>Title</span>
						<span>Artist</span>
						<!-- <span>Album</span> -->
						<span>Added by</span>

					</li>
					<% for(var i=0; i < playlistData.tracks.length; i++) { %>
						<li class="queue__track">
							<img class="queue__track-img" src="<%= playlistData.tracks[i].album.images[0].url %>" alt="Album cover of <%= playlistData.tracks[i].name %>">
							<span class="queue__track-name"><%= playlistData.tracks[i].name %></span>
							<span class="queue__track-artist"><%= playlistData.tracks[i].artists.map(a => a.name).join(', ') %></span>
							<!-- <span class="queue__track-album"><%= playlistData.tracks[i].album.name %></span> -->
							<span class="queue__track-addedby"><%= playlistData.tracks[i].addedBy %></span>
							<span class="queue__track-likes">
								<span class="like-amount"><%= playlistData.tracks[i].likes %></span>
								<%
								var liked;
								if(playlistData.tracks[i].userLiked.length === 0){ %>
									<button type="button" class="track-like-button" data-id="<%= playlistData.tracks[i]._id %>">Like</button>
								<% }
								else {
									 for(var j=0; j < playlistData.tracks[i].userLiked.length; j++) {
										if(user.spotifyId ===  playlistData.tracks[i].userLiked[j]){
											liked = true;
											break;
										 }
										else {
											liked = false;
										 }
									 }
									 if(liked === true){ %>
										<button type="button" class="track-like-button--disabled" data-id="<%= playlistData.tracks[i]._id %>" disabled>Like</button>
									<% } else {%>
										<button type="button" class="track-like-button" data-id="<%= playlistData.tracks[i]._id %>">Like</button>
									<% }
								} %>
							</span>
							<% if(playlistData.tracks[i].addedBy === user.spotifyId){ %>
								<button type="button" class="track-delete-button" data-id="<%= playlistData.tracks[i]._id %>">Delete</button>
							<% } %>
						</li>
					<% } %>
				</ul>
			</section>

			<!-- <img src="https://api.qrserver.com/v1/create-qr-code/?color=ffffff&bgcolor=000000&data=https://spotifytogether.herokuapp.com/playlist/<%= playlistData.qrCodeId%>/<%=playlistData._id %>" alt=""> -->
		</main>

		<section id="add-track">
			<div class="add-track-wrapper">
				<header>
					<h2>Add songs to <%= playlistData.name %></h2>
					<a href="#" class="close-add-tracks">Close</a>
				</header>
			</div>
		</section>


		<ul class="fetch-devices-wrapper"></ul>
		<section id="player">

			<div class="player-details">
				<img src="<%= playlistData.tracks[0].album.images[0].url %>" alt="" class="player-details__track-img">
				<div class="player-details__text">
					<p class="player-details__track-name"><%= playlistData.tracks[0].name %></p>
					<p class="player-details__artist-name"><%= playlistData.tracks[0].artists.map(a => a.name).join(', ') %></p>
				</div>
			</div>


			<div class="player-controls">
				<button class="prev-button">Back</button>
				<button class="play-button">Play</button>
				<button class="stop-button hidden">Pause</button>
				<button class="next-button">Next</button>
			</div>


			<button type="button" class="fetch-devices-button">Fetch Devices</button>
		</section>

		<% include ./partials/scripts %>
</body>

</html>
